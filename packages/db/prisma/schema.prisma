generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ShortlistSnapshot {
  id            String        @id @default(uuid())
  timestamp     DateTime
  shortlistType ShortlistType
  entries       Json // Array of shortlist items with nseSymbol, name, price

  createdAt DateTime @default(now()) @db.Timestamptz(6)
  updatedAt DateTime @updatedAt

  @@index([timestamp])
  @@map("shortlist_snapshots")
}

model QuoteSnapshot {
  id        String   @id @default(uuid())
  timestamp DateTime
  nseSymbol String
  quoteData Json // Full quote payload from Groww API

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([timestamp])
  @@index([nseSymbol])
  @@index([timestamp, nseSymbol])
  @@map("quote_snapshots")
}

model NiftyQuote {
  id            String   @id @default(uuid())
  timestamp     DateTime
  quoteData     Json // Full NIFTY quote payload
  dayChangePerc Decimal

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([timestamp])
  @@map("nifty_quotes")
}

model DeveloperToken {
  username String @id @unique
  token    String @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([token])
  @@map("developer_tokens")
}

model CollectorError {
  id           String   @id @default(uuid())
  timestamp    DateTime
  errorMessage String
  errorStack   String?
  errorContext Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([timestamp])
  @@map("collector_errors")
}

enum ShortlistType {
  TOP_GAINERS
  VOLUME_SHOCKERS
}
